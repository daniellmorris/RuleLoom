version: 1
plugins:
  - source: file
    path: ../../../plugins/rule-loom-core
  - source: file
    path: ../../../plugins/rule-loom-plugin-http
inputs:
  - type: http
    config: {}
    triggers:
      - type: httpRoute
        method: post
        path: /flow
        flow: process-user
closures:
  - type: flow
    name: enrich-user
    steps:
      - closure: core.assign
        parameters:
          target: metadata.status
          value: processed
flows:
  - name: process-user
    steps:
      - closure: core.assign
        parameters:
          target: user
          value: "${request.body}"
      - closure: enrich-user
      - closure: core.respond
        parameters:
          status: 200
          body:
            id: "${state.user.id}"
            total: "${state.user.total}"
            status: "${state.metadata.status}"
