version: 1
inputs:
  - type: http
    routes:
      - method: post
        path: /format
        flow: format-order
closures:
  - type: core
  - type: module
    module: ../modules/call-inline-closures.js
flows:
  - name: format-order
    steps:
      - closure: core.assign
        parameters:
          target: order
          value: "${request.body}"
      - closure: format-total
        parameters:
          total: "${state.order.total}"
      - closure: core.respond
        parameters:
          status: 200
          body:
            message:
              $call:
                name: format-message
                parameters:
                  id: "${state.order.id}"
                  total: "${state.order.total}"
