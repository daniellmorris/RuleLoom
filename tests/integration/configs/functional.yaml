version: 1
inputs:
  - type: http
    routes:
      - method: post
        path: /items
        flow: list-items
flows:
  - name: list-items
    steps:
      - closure: core.assign
        parameters:
          target: payload
          value: "${request.body}"
      - closure: core.assign
        parameters:
          target: processed
          value: []
      - closure: core.for-each
        collection: "${state.payload.items}"
        steps:
          - closure: core.assign
            parameters:
              target: "processed.${state.currentIndex}"
              value:
                index: "${state.currentIndex}"
                value: "${state.currentItem}"
      - closure: core.respond
        parameters:
          status: 200
          body:
            items: "${state.processed}"
